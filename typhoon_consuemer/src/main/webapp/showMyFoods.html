<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Merchant Main</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link rel="stylesheet" type="text/css"
          href="common/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" type="text/css"
          href="common/bootstrap/dist/css/bootstrap-theme.css">
    <script src="common/jquery/dist/jquery.js"></script>
    <script src="common/bootstrap/dist/js/bootstrap.js"></script>


    <link rel="stylesheet" type="text/css"
          href="common/index_lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css"
          href="common/index_lib/stylesheets/theme.css">
    <link rel="stylesheet"
          href="common/index_lib/font-awesome/css/font-awesome.css">
    <script src="common/index_lib/jquery-1.7.2.min.js"
            type="text/javascript"></script>
    <script src="common/index_lib/bootstrap/js/bootstrap.js"></script>

    <style type="text/css">
        .brand {
            font-family: georgia, serif;
        }

        .brand .first {
            color: #ccc;
            font-style: unset;
        }
    </style>


</head>

<body>

<div class="navbar">
		<div class="navbar-inner">
			<ul class="nav pull-right">
				<li id="fat-menu" class="dropdown"><a href="#" role="button"
					class="dropdown-toggle" data-toggle="dropdown"> <i
						class="icon-user"></i>操作
				</a>
					<ul class="dropdown-menu">
						<li><a tabindex="-1" href="login.html">退出</a></li>
					</ul></li>
			</ul>
			<a class="brand" href="index.html"><span class="first">商家管理</span></a>
		</div>
	</div>


<div class="sidebar-nav">
    <a href="#shop-menu" class="nav-header" data-toggle="collapse"></i>店铺操作</a>
    <ul id="shop-menu" class="nav nav-list collapse in">
        <li><a href="showShopStatus.html">店铺状态</a></li>
        <li><a href="showRegisterInfo.html">查看注册信息</a></li>
        <li><a href="applyAd.html">申请店铺广告</a></li>
    </ul>
    <a href="#food-menu" class="nav-header" data-toggle="collapse"></i>菜品操作</a>
    <ul id="food-menu" class="nav nav-list collapse in">
        <li><a href="showMyFoods.html">查看我的菜品</a></li>
        <li><a href="addFood.html">添加菜品</a></li>
    </ul>
    <a href="#user-menu" class="nav-header" data-toggle="collapse"></i>个人操作</a>
    <ul id="user-menu" class="nav nav-list collapse in">
        <li><a href="updateInfo.html">修改个人信息</a></li>
        <li><a href="updatePw.html">修改密码</a></li>
    </ul>
</div>
<div class="content">

    <div class="header">

        <h1 class="page-title">我的菜品</h1>
    </div>

    <div class="container-fluid">
        <div class="row-fluid">

            <div class="btn-toolbar">
                <button class="btn btn-primary"
                        onclick="javascript:window.location.href='addFood.html' ">添加一个菜品</button>
                <div class="btn-group"></div>
            </div>
            <div class="well">
                <table class="table">
                    <thead>
                    <tr>
                        <th>id</th>
                        <th style="width: 260px;">菜品名</th>
                        <th>图片</th>
                        <th style="width: 260px;">价格</th>
                        <th style="width: 260px;">介绍</th>
                        <th style="width: 260px;"></th>
                    </tr>
                    </thead>
                    <tbody id="tb">
                    </tbody>

                </table>

                共<span id="totalPage"></span>页/<span id="totalCount"></span>条数据
                每页显示<input type="number" id="pageSize" value=3>条
                <nav aria-label="Page navigation" id="page"></nav>
                <input type="hidden" id="currentPage" value=1>
            </div>

            <div class="modal small hide fade" id="myModal" tabindex="-1"
                 role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×</button>
                    <h3 id="myModalLabel">Delete Confirmation</h3>
                </div>
                <div class="modal-body">
                    <p class="error-text">
                        <i class="icon-warning-sign modal-icon"></i>你想删除这个菜吗？
                    </p>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button class="btn btn-danger" data-dismiss="modal">Delete</button>
                </div>
            </div>
            <footer>
                <hr>
            </footer>

        </div>
    </div>
</div>
</div>
<script>
window.onload = function() {
    let url = "http://localhost:9090/typhoon_merchant/ShowFoodsServletbyPage";
    let method = "GET";
    let headers = [ {
        "key" : "Content-Type",
        "value" : "application/json",

    } ];
    showShopStatus = function() {
		let url = "http://localhost:9090/typhoon_merchant/showShopStatusServlet";
		let method = "GET";
		let headers = [ {
			"key" : "Content-Type",
			"value" : "application/json"
		} ];
		///////////////////////////////////////////
		function renderTable(checkStatus) {
		}
		///////////////////////////////////////////
		function getData(method, url, data, headers) {
			$.ajax({
				type : method,
				url : url,
				dataType:"json",
				success : function(data) {
					let checkStatus = JSON.stringify(data)
					let status = JSON.parse(checkStatus);
					if(status.checkStatus!=1){
						alert("你没有资格")
						window.location.href='showShopStatus.html'
					}
				},
				error : function(err) {
					alert(JSON.stringify(err));
				}
			});

		}
		getData(method, url, null, headers);
	}
    function renderTable(data) {
        let tbody = document.querySelector("#tb");
        for (let i = 0; i < data.length; i++) {
            let tr = $("<tr>");
            $("<td>").text(data[i].id).appendTo(tr);
            $("<td>").text(data[i].foodName).appendTo(tr);
            $("<td>").append(
                $("<img width='130'>").attr('src',
                    data[i].picture)).appendTo(tr);
            $("<td>").text(data[i].price).appendTo(tr);
            $("<td>").text(data[i].info).appendTo(tr);
            let updateA = $(
                "<a href='updateFood.html?id=" + data[i].id
                + "'>").append(
                $("<i class='icon-pencil'>"))
            updateA.appendTo(tr)
            let deleteA = $(
                "<a href='#myModal' role='button' data-toggle='modal'>")
                .append($("<i class='icon-remove'>"))
            tr.appendTo(tbody).addClass("datas");
        }
    }
    function getData(method, url, data, headers) {
        $.ajax({
            type : method,
            url : url,
            data:"pageSize="
                + $("#pageSize").val()
                + "&currentPage="
                + $("#currentPage").val(),
            dataType : "json",
            success : function(data) {
                makePage(data)
                renderTable(data.dataList)
            },
            error : function(err) {
                alert(JSON.stringify(err));
            }
        });
    }
    function makePage(data) {
        let totalPage = data.totalPage;
        let totalCount = data.totalCount;
        $(".pagination").remove();
        let page = $("#page");
        let ul = $("<ul>").addClass("pagination");
        ul.appendTo(page);
        let li1 = $("<li>").addClass("lis").appendTo(ul);
        let a1 = $("<a>").attr("href", "#").attr("aria-label",
            "Previous").appendTo(li1);
        $("<span>").attr("aria-hidden", "true").text("首页")
            .appendTo(a1);
        for (let i = 0; i < totalPage; i++) {
            let li = $("<li>").addClass("lis");
            $("<a>").attr("href", "#").text(i + 1).appendTo(li);
            li.appendTo(ul);
        }
        let li2 = $("<li>").addClass("lis").appendTo(ul);
        let a2 = $("<a>").attr("href", "#").attr("aria-label",
            "Previous").appendTo(li2);
        $("<span>").attr("aria-hidden", "true").text("尾页")
            .appendTo(a2)
        $("#totalPage").text(data.totalPage);
        $("#totalCount").text(data.totalCount);
        $(".lis").on("click", function() {
            if ($(this).text() == "首页") {
                $("#currentPage").val(1);
            } else if ($(this).text() == "尾页") {
                $("#currentPage").val(totalPage);
            } else {
                $("#currentPage").val($(this).text());
            }
            $(".datas").remove();
            getData(method, url, null, headers);
        })
    }

    $("#pageSize").on("blur", function() {
        $(".datas").remove();
        getData(method, url, null, headers);
    })
showShopStatus();
    getData(method, url, null, headers)
}
</script>
</body>
</html>


